(()=>{"use strict";var e={2918:function(e,t,r){var i,n=r(5893),o=r(7294),a=r(745),s=r(8106),l=r(9719),c=r(7884),p=r(483),d=r(7230),m=r(6881);let u={prompt:"",schemaFile:new File([JSON.stringify(JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"PrescriptionList","description":"A list of glasses prescriptions.","type":"array","items":{"title":"Prescription","description":"Schema for structuring glasses prescription information based on instructions.","type":"object","properties":{"patient":{"type":"object","description":"Information about the patient.","properties":{"firstName":{"type":"string","description":"Patient\'s first name."},"lastName":{"type":"string","description":"Patient\'s last name."},"birthdate":{"type":"string","description":"Patient\'s birth date in YYYY-MM-DD format."}},"required":["firstName","lastName"]},"prescriber":{"type":"object","description":"Information about the prescriber.","properties":{"fullName":{"type":"string","description":"Full name of the prescriber/doctor."},"email":{"type":"string","description":"Prescriber\'s email address."},"address":{"type":"string","description":"Address of the prescriber\'s office."},"adeliNumber":{"type":"string","description":"ADELI identification number, format: 0-9 digits.","pattern":"^$|^0?\\\\d{9}$"}},"required":["fullName"]},"prescription":{"type":"object","description":"Details of the prescription.","properties":{"prescribedAt":{"type":"string","description":"Date when prescription was issued in YYYY-MM-DD format."},"expirationDate":{"type":"string","description":"End date of validity period in YYYY-MM-DD format."},"right":{"type":"object","description":"Prescription for right eye (OD - Œil droit).","properties":{"visionType":{"type":"string","enum":["VL","VP"],"description":"Type of vision correction: VL (far vision), VP (near vision)."},"sphere":{"type":"number","description":"Spherical correction, range from min to max.","minimum":-20,"max":20},"cylinder":{"type":"number","description":"Cylindrical correction, range from minimum to maximum.","minimum":-10,"maximum":0},"axis":{"type":"number","description":"Axis value, range from minimum to maximum.","minimum":0,"maximum":180},"add":{"type":"number","description":"Addition value, range from minimum to maximum.","minimum":0,"maximum":4},"deg":{"type":"number","description":"Degression value, range from minimum to maximum.","minimum":0,"maximum":360},"base":{"type":"string","enum":["IN","OUT","UP","DOWN"],"description":"Direction of the base."},"pd":{"type":"number","description":"Pupillary distance in mm for right eye."},"va":{"type":"string","description":"Visual acuity for right eye."}},"required":["visionType","sphere","cylinder","axis"]},"left":{"type":"object","description":"Prescription for left eye (OG - Œil gauche).","properties":{"visionType":{"type":"string","enum":["VL","VP"],"description":"Type of vision correction: VL (far vision), VP (near vision)."},"sphere":{"type":"number","description":"Spherical correction, range from -20 to +20."},"cylinder":{"type":"number","description":"Cylindrical correction, range from -10 to 0."},"axis":{"type":"number","description":"Axis value, range from 0 to 180."},"add":{"type":"number","description":"Addition value, range from 0 to 4."},"deg":{"type":"number","description":"Degression value, range from 0 to 360."},"base":{"type":"string","enum":["IN","OUT","UP","DOWN"],"description":"Direction of the base."},"pd":{"type":"number","description":"Pupillary distance in mm for left eye."},"va":{"type":"string","description":"Visual acuity for left eye."}},"required":["visionType","sphere","cylinder","axis"]},"treatment":{"type":"string","description":"Special treatments or filters for lenses."},"tint":{"type":"string","description":"Color or tint applied to lenses."}},"required":["prescribedAt","right","left"]}},"required":["patient","prescriber","prescription"]}}'))],"prescription-schema.json",{type:"application/json"}),targetFile:null};var f=((i={}).Success="success",i.Error="error",i),h=r(6775),y=r(7361),g=r.n(y),b=r(6595);let x=async e=>{let t=await fetch(e);if(!t.ok)throw console.error(`Failed to fetch the file: ${e}`),Error("Failed to fetch the file");let r=t.headers.get("content-type");return r?b.Z.getExtension(r):null},v=new h.Mistral({apiKey:"diGcUz0gZW5uNlMbXIktFfDimm30ca3D"}),j=async e=>{let t=await x(e);switch(t){case"pdf":return{type:"document_url",documentUrl:e};case"png":case"jpg":case"jpeg":return{type:"image_url",imageUrl:e};default:throw Error(`Unsupported file type - ${t}`)}},w={extractFileContent:async e=>{var t;let r=await j(e);return(null==(t=(await v.ocr.process({model:"mistral-ocr-latest",document:r,includeImageBase64:!0})).pages[0])?void 0:t.markdown)||null},run:async e=>{let{prompt:t,schema:r=null,fileContent:i=null}=e,n=[{type:"text",text:t}];r&&n.push({type:"text",text:`### Output Format (JSON Schema): ${r}`}),i&&(console.info(i),n.push({type:"text",text:`### File content in Markdown: ${i}`}));try{let e=await v.chat.complete({model:"mistral-small-latest",messages:[{role:"user",content:n}]});return g()(e,"choices[0].message.content")}catch(e){throw Error(`Error processing image: ${e.message}`)}}},O={mistral:w},P=(e=>{if(!O[e])throw Error(`Strategy ${e} not found`);return O[e]})("mistral"),F={extractFileContent:w.extractFileContent,run:P.run};Object.freeze(F);let E=e=>{let t=new FileReader;return new Promise((r,i)=>{t.readAsDataURL(e),t.onload=()=>r(t.result),t.onerror=e=>i(e)})},Z=async e=>{let t=new FileReader;return new Promise((r,i)=>{t.readAsText(e),t.onload=()=>r(t.result),t.onerror=e=>i(e)})},D=async e=>{let{prompt:t,schemaFile:r,fileURL:i,targetFile:n}=e,o=(null==r?void 0:r.name)?await Z(r):null,a=(null==n?void 0:n.name)?await E(n):i;try{if(!t||!a)throw Error("Please provide all required data");let e=await F.extractFileContent(a);await new Promise(e=>setTimeout(e,1e3));let r=await F.run({prompt:t,schema:o,fileContent:e});if(!r)throw Error("No data found");return{status:f.Success,message:r}}catch(e){return{status:f.Error,message:e.message}}};var S=r(1035),C=r(9599),L=r(7454);let N=e=>{let{defaultValue:t=[],setFile:r}=e,[i,n]=(0,o.useState)(t),a=(0,o.useRef)(null);(0,o.useEffect)(()=>{i.length?r(i[0]):r(null)},[i]),(0,o.useEffect)(()=>{if(i.length){let e=new DataTransfer;i.map(t=>e.items.add(t)),a.current.files=e.files}else a.current.value=""},[i]),(0,o.useEffect)(()=>{let e=a.current;return e.addEventListener("change",s),e.addEventListener("cancel",l),()=>{e.removeEventListener("change",s),e.removeEventListener("cancel",l)}},[]);let s=e=>{let t=e.target.files;t&&t.length>0?n(Array.from(t)):n([])},l=()=>{n([])};return{files:i,handleChange:s,handleRemove:e=>()=>{n(i.filter(t=>t.name!==e.name))},fileInputRef:a}},U=e=>{let t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=e.name,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},k=e=>{let{defaultValue:t,setFile:r}=e,{files:i,fileInputRef:o,handleRemove:a}=N({defaultValue:[t],setFile:r});return(0,n.jsxs)(l.Z,{direction:"row",spacing:2,marginBottom:2,children:[(0,n.jsxs)(d.Z,{component:"label",variant:"contained",tabIndex:-1,sx:{width:200,height:55},children:["Choose schema",(0,n.jsx)("input",{style:{display:"none"},type:"file",name:"schemaFile",accept:"application/json",ref:o})]}),null==i?void 0:i.map(e=>(0,n.jsxs)(l.Z,{direction:"row",alignItems:"center",gap:2,children:[(0,n.jsx)("strong",{children:e.name}),(0,n.jsxs)(l.Z,{direction:"row",children:[(0,n.jsx)(S.Z,{"aria-label":"delete",onClick:()=>U(e),color:"primary",children:(0,n.jsx)(C.Z,{})}),(0,n.jsx)(S.Z,{"aria-label":"delete",onClick:a(e),color:"primary",children:(0,n.jsx)(L.Z,{})})]})]},e.name))]})},T=e=>{let{defaultValue:t,setFile:r}=e,{files:i,fileInputRef:o,handleRemove:a}=N({defaultValue:t?[t]:[],setFile:r});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,n.jsx)(p.Z,{fullWidth:!0,disabled:i.length,type:"url",name:"fileURL",label:"URL"}),(0,n.jsxs)(d.Z,{component:"label",variant:"contained",tabIndex:-1,sx:{width:200,height:55},children:["Choose file",(0,n.jsx)("input",{style:{display:"none"},type:"file",name:"targetFile",accept:"image/*,application/pdf",ref:o})]})]}),null==i?void 0:i.map(e=>(0,n.jsxs)(l.Z,{direction:"row",alignItems:"center",gap:1,children:[(0,n.jsx)("strong",{children:e.name}),(0,n.jsx)(S.Z,{"aria-label":"delete",onClick:a(e),color:"primary",children:(0,n.jsx)(L.Z,{})})]},e.name))]})};var _=r(7245),V=r(6847);let M=(0,V.ZP)("div")`
  padding: 16px;
  background-color: ${e=>{let{status:t}=e;return t===f.Error?"#f5dfe0":"#f1fff3"}};
  color: ${e=>{let{status:t}=e;return t===f.Error?"#4c0e16":"#01480a"}};
`,R=e=>{let{result:t}=e,{status:r,message:i}=t;return(0,n.jsx)(M,{status:r,children:(0,n.jsx)(_.UG,{children:i})})},A=function(){let e,[t,r]=(0,o.useState)(!1),[i,a]=(0,o.useState)({status:"",message:""}),[s,f]=(0,o.useState)({prompt:u.prompt,fileURL:"",schemaFile:u.schemaFile,targetFile:u.targetFile}),h=e=>t=>{f({...s,[e]:t})},y=async e=>{e.preventDefault(),r(!0),a(await D(s)),r(!1)};return(0,n.jsxs)(l.Z,{paddingY:2,children:[(0,n.jsx)("h1",{children:"OCR AI Tool"}),(0,n.jsx)("form",{style:{marginBottom:20},onSubmit:y,children:(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:2},children:[(0,n.jsx)(p.Z,{required:!0,fullWidth:!0,multiline:!0,defaultValue:s.prompt,name:"prompt",label:"Prompt",onChange:(e="prompt",t=>{f({...s,[e]:t.target.value})})}),(0,n.jsx)(k,{defaultValue:s.schemaFile,setFile:h("schemaFile")}),(0,n.jsx)(T,{defaultValue:s.targetFile,setFile:h("targetFile")}),(0,n.jsx)(d.Z,{variant:"contained",type:"submit",disabled:t,children:"Process"})]})}),t&&(0,n.jsx)(m.Z,{}),!t&&i.status&&(0,n.jsx)(R,{result:i})]})};a.createRoot(document.getElementById("root")).render((0,n.jsx)(o.StrictMode,{children:(0,n.jsx)(()=>(0,n.jsx)(s.Z,{children:(0,n.jsx)(A,{})}),{})}))}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,r),o.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(i,n){if(1&n&&(i=this(i)),8&n||"object"==typeof i&&i&&(4&n&&i.__esModule||16&n&&"function"==typeof i.then))return i;var o=Object.create(null);r.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&n&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>{a[e]=()=>i[e]});return a.default=()=>i,r.d(o,a),o}})(),r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];r.O=(t,i,n,o)=>{if(i){o=o||0;for(var a=e.length;a>0&&e[a-1][2]>o;a--)e[a]=e[a-1];e[a]=[i,n,o];return}for(var s=1/0,a=0;a<e.length;a++){for(var[i,n,o]=e[a],l=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(r.O).every(e=>r.O[e](i[c]))?i.splice(c--,1):(l=!1,o<s&&(s=o));if(l){e.splice(a--,1);var p=n();void 0!==p&&(t=p)}}return t}})(),r.rv=()=>"1.3.1",(()=>{var e={980:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,[a,s,l]=i,c=0;if(a.some(t=>0!==e[t])){for(n in s)r.o(s,n)&&(r.m[n]=s[n]);if(l)var p=l(r)}for(t&&t(i);c<a.length;c++)o=a[c],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(p)},i=self.webpackChunkocr_ai_tool=self.webpackChunkocr_ai_tool||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r.ruid="bundler=rspack@1.3.1";var i=r.O(void 0,["361","489"],function(){return r(2918)});i=r.O(i)})();